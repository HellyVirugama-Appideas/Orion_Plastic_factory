<%- include('../layouts/main', { body: `
<div class="page-header">
  <div class="page-title-row">
    <div>
      <h1 class="page-title">Dashboard</h1>
      <p class="page-subtitle">Welcome back, ${user.name}! Here's what's happening today.</p>
    </div>
    <div style="display: flex; gap: 12px;">
      <button class="btn btn-secondary">
        <i class="fas fa-download"></i>
        Export Report
      </button>
      <a href="/admin/orders/create" class="btn btn-primary">
        <i class="fas fa-plus"></i>
        New Order
      </a>
    </div>
  </div>
</div>

<!-- Stats Cards -->
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-header">
      <div class="stat-icon">
        <i class="fas fa-shopping-cart"></i>
      </div>
      <div class="stat-change positive">
        <i class="fas fa-arrow-up"></i>
        12.5%
      </div>
    </div>
    <div class="stat-value">${stats.totalOrders}</div>
    <div class="stat-label">Total Orders</div>
  </div>
  
  <div class="stat-card success">
    <div class="stat-header">
      <div class="stat-icon">
        <i class="fas fa-truck"></i>
      </div>
      <div class="stat-change positive">
        <i class="fas fa-arrow-up"></i>
        8.2%
      </div>
    </div>
    <div class="stat-value">${stats.activeDeliveries}</div>
    <div class="stat-label">Active Deliveries</div>
  </div>
  
  <div class="stat-card warning">
    <div class="stat-header">
      <div class="stat-icon">
        <i class="fas fa-user-tie"></i>
      </div>
      <div class="stat-change negative">
        <i class="fas fa-arrow-down"></i>
        3.1%
      </div>
    </div>
    <div class="stat-value">${stats.availableDrivers}</div>
    <div class="stat-label">Available Drivers</div>
  </div>
  
  <div class="stat-card danger">
    <div class="stat-header">
      <div class="stat-icon">
        <i class="fas fa-rupee-sign"></i>
      </div>
      <div class="stat-change positive">
        <i class="fas fa-arrow-up"></i>
        15.3%
      </div>
    </div>
    <div class="stat-value">₹${stats.todayRevenue ? stats.todayRevenue.toLocaleString() : '0'}</div>
    <div class="stat-label">Today's Revenue</div>
  </div>
</div>

<!-- Charts Row -->
<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 32px;">
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Order Trends</h3>
      <div style="display: flex; gap: 8px;">
        <button class="btn btn-sm btn-secondary">Week</button>
        <button class="btn btn-sm btn-primary">Month</button>
        <button class="btn btn-sm btn-secondary">Year</button>
      </div>
    </div>
    <div class="card-body">
      <canvas id="orderTrendsChart" height="80"></canvas>
    </div>
  </div>
  
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Order Status</h3>
    </div>
    <div class="card-body">
      <canvas id="orderStatusChart"></canvas>
      <div style="margin-top: 20px;">
        ${orderStatusBreakdown.map(status => `
          <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color);">
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 12px; height: 12px; border-radius: 50%; background: ${getStatusColor(status._id)};"></div>
              <span style="font-size: 14px; color: var(--text-secondary); text-transform: capitalize;">${status._id.replace('_', ' ')}</span>
            </div>
            <span style="font-weight: 600; color: var(--text-primary);">${status.count}</span>
          </div>
        `).join('')}
      </div>
    </div>
  </div>
</div>

<!-- Recent Orders & Active Deliveries -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 32px;">
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Recent Orders</h3>
      <a href="/admin/orders" class="btn btn-sm btn-secondary">View All</a>
    </div>
    <div class="card-body" style="padding: 0;">
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Status</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody>
            ${recentOrders.slice(0, 5).map(order => `
              <tr onclick="window.location='/admin/orders/${order._id}'" style="cursor: pointer;">
                <td>
                  <span style="font-weight: 600; color: var(--primary-color);">${order.orderNumber}</span>
                </td>
                <td>
                  <div>
                    <div style="font-weight: 500;">${order.customerId?.name || 'N/A'}</div>
                    <div style="font-size: 12px; color: var(--text-light);">${order.customerId?.email || ''}</div>
                  </div>
                </td>
                <td>
                  <span class="badge badge-${getStatusBadgeClass(order.status)}">${order.status.replace('_', ' ')}</span>
                </td>
                <td>
                  <span style="font-weight: 600;">₹${order.totalAmount ? order.totalAmount.toLocaleString() : '0'}</span>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Active Deliveries</h3>
      <a href="/admin/tracking/live" class="btn btn-sm btn-primary">
        <i class="fas fa-map-marked-alt"></i>
        Live Map
      </a>
    </div>
    <div class="card-body" style="padding: 0;">
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Tracking #</th>
              <th>Driver</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            ${activeDeliveries.slice(0, 5).map(delivery => `
              <tr>
                <td>
                  <span style="font-weight: 600; color: var(--primary-color);">${delivery.trackingNumber}</span>
                </td>
                <td>
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--primary-gradient); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 12px;">
                      ${delivery.driverId?.name?.charAt(0) || 'D'}
                    </div>
                    <div>
                      <div style="font-weight: 500; font-size: 14px;">${delivery.driverId?.name || 'Unassigned'}</div>
                      <div style="font-size: 12px; color: var(--text-light);">${delivery.driverId?.vehicleNumber || ''}</div>
                    </div>
                  </div>
                </td>
                <td>
                  <span class="badge badge-${getDeliveryStatusBadgeClass(delivery.status)}">${delivery.status.replace('_', ' ')}</span>
                </td>
                <td>
                  <a href="/admin/deliveries/${delivery._id}" class="btn btn-sm btn-secondary">
                    <i class="fas fa-eye"></i>
                  </a>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
  // Order Trends Chart
  const orderTrendsCtx = document.getElementById('orderTrendsChart').getContext('2d');
  new Chart(orderTrendsCtx, {
    type: 'line',
    data: {
      labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
      datasets: [{
        label: 'Orders',
        data: [12, 19, 15, 25, 22, 30, 28],
        borderColor: '#667eea',
        backgroundColor: 'rgba(102, 126, 234, 0.1)',
        tension: 0.4,
        fill: true
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          grid: {
            color: 'rgba(0, 0, 0, 0.05)'
          }
        },
        x: {
          grid: {
            display: false
          }
        }
      }
    }
  });
  
  // Order Status Chart
  const orderStatusCtx = document.getElementById('orderStatusChart').getContext('2d');
  new Chart(orderStatusCtx, {
    type: 'doughnut',
    data: {
      labels: ${JSON.stringify(orderStatusBreakdown.map(s => s._id))},
      datasets: [{
        data: ${JSON.stringify(orderStatusBreakdown.map(s => s.count))},
        backgroundColor: [
          '#667eea',
          '#10b981',
          '#f59e0b',
          '#ef4444',
          '#3b82f6'
        ]
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: {
          display: false
        }
      }
    }
  });
  
  function getStatusColor(status) {
    const colors = {
      pending: '#f59e0b',
      confirmed: '#3b82f6',
      processing: '#667eea',
      delivered: '#10b981',
      cancelled: '#ef4444'
    };
    return colors[status] || '#64748b';
  }
</script>
` }) %>
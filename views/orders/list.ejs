<%- include('../layouts/main', { body: `
<div class="page-header">
  <div class="page-title-row">
    <div>
      <h1 class="page-title">Orders</h1>
      <nav class="breadcrumb">
        <a href="/admin/dashboard">Dashboard</a>
        <i class="fas fa-chevron-right"></i>
        <span>Orders</span>
      </nav>
    </div>
    <a href="/admin/orders/create" class="btn btn-primary">
      <i class="fas fa-plus"></i>
      Create Order
    </a>
  </div>
</div>

<!-- Filters -->
<div class="card" style="margin-bottom: 24px;">
  <div class="card-body">
    <form method="GET" action="/admin/orders" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; align-items: end;">
      <div class="form-group" style="margin-bottom: 0;">
        <label class="form-label">Search</label>
        <input 
          type="text" 
          name="search" 
          class="form-control" 
          placeholder="Order number, customer..." 
          value="${filters?.search || ''}"
        >
      </div>
      
      <div class="form-group" style="margin-bottom: 0;">
        <label class="form-label">Status</label>
        <select name="status" class="form-control">
          <option value="">All Status</option>
          <option value="pending" ${filters?.status === 'pending' ? 'selected' : ''}>Pending</option>
          <option value="confirmed" ${filters?.status === 'confirmed' ? 'selected' : ''}>Confirmed</option>
          <option value="processing" ${filters?.status === 'processing' ? 'selected' : ''}>Processing</option>
          <option value="delivered" ${filters?.status === 'delivered' ? 'selected' : ''}>Delivered</option>
          <option value="cancelled" ${filters?.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
        </select>
      </div>
      
      <div class="form-group" style="margin-bottom: 0;">
        <label class="form-label">Priority</label>
        <select name="priority" class="form-control">
          <option value="">All Priority</option>
          <option value="low" ${filters?.priority === 'low' ? 'selected' : ''}>Low</option>
          <option value="medium" ${filters?.priority === 'medium' ? 'selected' : ''}>Medium</option>
          <option value="high" ${filters?.priority === 'high' ? 'selected' : ''}>High</option>
          <option value="urgent" ${filters?.priority === 'urgent' ? 'selected' : ''}>Urgent</option>
        </select>
      </div>
      
      <div style="display: flex; gap: 8px;">
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-filter"></i>
          Filter
        </button>
        <a href="/admin/orders" class="btn btn-secondary">
          <i class="fas fa-redo"></i>
          Reset
        </a>
      </div>
    </form>
  </div>
</div>

<!-- Orders Table -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">All Orders (${orders.length})</h3>
    <div style="display: flex; gap: 8px;">
      <button class="btn btn-sm btn-secondary">
        <i class="fas fa-download"></i>
        Export
      </button>
    </div>
  </div>
  <div class="card-body" style="padding: 0;">
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Customer</th>
            <th>Date</th>
            <th>Status</th>
            <th>Priority</th>
            <th>Amount</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          ${orders.length === 0 ? `
            <tr>
              <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-light);">
                <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 16px; display: block;"></i>
                No orders found
              </td>
            </tr>
          ` : orders.map(order => `
            <tr onclick="window.location='/admin/orders/${order._id}'" style="cursor: pointer;">
              <td>
                <span style="font-weight: 600; color: var(--primary-color);">${order.orderNumber}</span>
              </td>
              <td>
                <div>
                  <div style="font-weight: 500;">${order.customerId?.name || 'N/A'}</div>
                  <div style="font-size: 12px; color: var(--text-light);">${order.customerId?.email || ''}</div>
                </div>
              </td>
              <td>
                <div style="font-size: 14px;">${new Date(order.createdAt).toLocaleDateString()}</div>
                <div style="font-size: 12px; color: var(--text-light);">${new Date(order.createdAt).toLocaleTimeString()}</div>
              </td>
              <td>
                <span class="badge badge-${getStatusBadgeClass(order.status)}">
                  ${order.status.replace('_', ' ')}
                </span>
              </td>
              <td>
                <span class="badge badge-${getPriorityBadgeClass(order.priority)}">
                  ${order.priority}
                </span>
              </td>
              <td>
                <span style="font-weight: 600;">â‚¹${order.totalAmount ? order.totalAmount.toLocaleString() : '0'}</span>
              </td>
              <td onclick="event.stopPropagation();">
                <div style="display: flex; gap: 4px;">
                  <a href="/admin/orders/${order._id}" class="btn btn-sm btn-secondary" title="View">
                    <i class="fas fa-eye"></i>
                  </a>
                  <a href="/admin/orders/${order._id}/edit" class="btn btn-sm btn-secondary" title="Edit">
                    <i class="fas fa-edit"></i>
                  </a>
                  ${order.status === 'pending' ? `
                    <form method="POST" action="/admin/orders/${order._id}/confirm" style="display: inline;">
                      <button type="submit" class="btn btn-sm btn-success" title="Confirm">
                        <i class="fas fa-check"></i>
                      </button>
                    </form>
                  ` : ''}
                </div>
              </td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Pagination -->
${totalPages > 1 ? `
<div style="display: flex; justify-content: center; align-items: center; gap: 8px; margin-top: 24px;">
  <a href="?page=1${Object.keys(filters || {}).map(k => '&' + k + '=' + filters[k]).join('')}" 
     class="btn btn-sm btn-secondary ${currentPage === 1 ? 'disabled' : ''}">
    <i class="fas fa-angle-double-left"></i>
  </a>
  <a href="?page=${currentPage - 1}${Object.keys(filters || {}).map(k => '&' + k + '=' + filters[k]).join('')}" 
     class="btn btn-sm btn-secondary ${currentPage === 1 ? 'disabled' : ''}">
    <i class="fas fa-angle-left"></i>
  </a>
  
  ${Array.from({length: Math.min(5, totalPages)}, (_, i) => {
    const pageNum = currentPage <= 3 ? i + 1 : currentPage + i - 2;
    return pageNum <= totalPages ? `
      <a href="?page=${pageNum}${Object.keys(filters || {}).map(k => '&' + k + '=' + filters[k]).join('')}" 
         class="btn btn-sm ${currentPage === pageNum ? 'btn-primary' : 'btn-secondary'}">
        ${pageNum}
      </a>
    ` : '';
  }).join('')}
  
  <a href="?page=${currentPage + 1}${Object.keys(filters || {}).map(k => '&' + k + '=' + filters[k]).join('')}" 
     class="btn btn-sm btn-secondary ${currentPage === totalPages ? 'disabled' : ''}">
    <i class="fas fa-angle-right"></i>
  </a>
  <a href="?page=${totalPages}${Object.keys(filters || {}).map(k => '&' + k + '=' + filters[k]).join('')}" 
     class="btn btn-sm btn-secondary ${currentPage === totalPages ? 'disabled' : ''}">
    <i class="fas fa-angle-double-right"></i>
  </a>
</div>
` : ''}

<script>
  function getStatusBadgeClass(status) {
    const classes = {
      'pending': 'warning',
      'confirmed': 'info',
      'processing': 'info',
      'ready_for_pickup': 'success',
      'assigned': 'info',
      'in_transit': 'info',
      'delivered': 'success',
      'cancelled': 'danger',
      'rejected': 'danger'
    };
    return classes[status] || 'secondary';
  }
  
  function getPriorityBadgeClass(priority) {
    const classes = {
      'low': 'secondary',
      'medium': 'info',
      'high': 'warning',
      'urgent': 'danger'
    };
    return classes[priority] || 'secondary';
  }
</script>
` }) %>